# Backend FastAPI application for DrinkPoint system

This application is created using as core libs FastAPI+SQLAlchemy+Alembic+asyncpg.

## Run server

### Pre-setup commands:
- Install python 3.11
- Create virtual env  `python -m venv venv`
- Activate venv:
  - Windows `./venv/Scripts/activate`
  - Arm `source ./venv/bin/activate`
- Run `pip install -r requirements.txt`
- Copy in `backend` directory correct `.env` file

### Run local server
- You need to run *main.py* file from *backend* dir
- You can do this from root dir with command `python /backend/main.py`

  This command will start local server on http://127.0.0.1:8000

***

## Database

### Migrations

Migrations/revisions are implemented using Alembic lib.
Alembic doesn't let create more than one version before applying it to db. 
You need to run all commands from path `<project's root>/backend/`

More info about Alembic [HERE](https://alembic.sqlalchemy.org/en/latest/tutorial.html#the-migration-environment)

Commands:
- Create revision/version with autodetected/-generated changes `alembic revision --autogenerate -m  "<title>"`
- Create empty revision `alembic revision -m <title>`
- Apply revision to db `alembic upgrade <revision id>` or apply to latest/head `alembic upgrade head`
- Downgrade db to specified revision `alembic downgrade <revision id>`
- Get current db revision `alembic current`
- Get history of revisions `alembic history`
- Check if autogenerated migration can be created `alembic check`

***

## Deploy
...TODO

***

## Environment

Currently, we use 1 environment `development`, so only one `.env` file is used

***

## Workflow

### Branch Style:
When you create a new branch, you should use the syntax below:

```html
<!-- Style -->
<prefix>/<description>
```

> prefix -> one of the options: [feat, bug, ref, doc] -> [feature, refactoring, bug, documentation]
> 
> description -> a short description of the task

```html
<!-- Example: -->
feat/registration_endpoint
bug/registration_validation
ref/delete_outdated_registration
doc/registration
```


### Commit Style:
When you create a new commit, you should use the syntax below:

```html
<!-- Style -->
<prefix>: <description>
```

> prefix -> one of the options: [feat, ref, fix, doc] -> [feature, refactoring, fixing, documentation]

> description -> a description of what you did for this task

```html
<!-- Example: -->
feat: added localisation service
fix: fixed validation for endpoint
ref: moved schemas to separate module
doc: added comments for registration endpoint
```

***

## ðŸ“– Files structure
...TODO

***

## Localisation for frontend

pass


## Internationalisation using Babel

Run all commands from *backend* dir

* Init new localisation with .po file
  `pybabel init -i localisation/messages.pot -d ./localisation/locales -l en_US`
* Update specific localisation's .po file
  `pybabel update -i localisation/messages.pot -d ./localisation/locales -l en_US`
* Extract all messages to localisation/messages.pot file
  `pybabel extract -F babel.cfg -o localisation/messages.pot .`
* Compile all .po to .mo files. So that program could use them
  `pybabel compile -d localisation/locales`
